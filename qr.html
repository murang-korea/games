<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>íì•„ë¥´ì½”ë“œ ìƒì„±ê¸° â€” ë‹¨ì¼ íŒŒì¼</title>
<style>
  :root{ --bg:#0b1220; --card:#0f1724; --accent:#60a5fa; --muted:#9aa9c7; color-scheme:dark; }
  html,body{height:100%; margin:0; font-family:Inter, "Noto Sans KR", system-ui, sans-serif; background:linear-gradient(180deg,#071021 0%, #07172a 100%); color:#e6eef8;}
  .wrap{max-width:1100px; margin:24px auto; padding:18px; display:grid; gap:12px;}
  header{display:flex; gap:12px; align-items:center; justify-content:space-between;}
  header h1{margin:0; font-size:18px;}
  .panel{background:var(--card); padding:12px; border-radius:12px; box-shadow:0 6px 20px rgba(2,6,23,0.6);}
  .layout{display:grid; grid-template-columns: 1fr 420px; gap:12px;}
  .controls{display:grid; gap:10px;}
  label{font-size:13px; color:var(--muted);}
  input[type="text"], select, input[type="number"]{width:100%; padding:8px 10px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit;}
  .row{display:flex; gap:8px; align-items:center;}
  .btn{background:var(--accent); color:#021124; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600;}
  .btn.secondary{background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.04);}
  .preview{display:flex; flex-direction:column; align-items:center; gap:10px; padding:12px;}
  #qr-wrap{width:100%; background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); padding:12px; border-radius:8px; display:flex; align-items:center; justify-content:center;}
  .small{font-size:12px; color:var(--muted);}
  .flex-between{display:flex; justify-content:space-between; align-items:center;}
  .logo-preview {width:64px; height:64px; object-fit:contain; border-radius:8px; background:#0b1220; padding:6px;}
  footer{color:var(--muted); font-size:13px; text-align:center; margin-top:6px;}
  @media(max-width:980px){ .layout{grid-template-columns: 1fr; } .preview{order:-1} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>ğŸ”² QR ì½”ë“œ ìƒì„±ê¸°</h1>
      <div class="small">ëª¨ì–‘ Â· ìƒ‰ Â· ë°°ê²½ Â· ë¡œê³  ë„£ê¸° Â· PNG/SVG ë‹¤ìš´ë¡œë“œ</div>
    </div>
    <div class="small">ë‹¨ì¼ HTML íŒŒì¼</div>
  </header>

  <div class="layout">
    <div class="panel controls">
      <div>
        <label>í…ìŠ¤íŠ¸ / URL</label>
        <input id="text" type="text" placeholder="https://example.com ë˜ëŠ” ì›í•˜ëŠ” í…ìŠ¤íŠ¸" value="https://example.com" />
      </div>

      <div class="row">
        <div style="flex:1">
          <label>ì‚¬ì´ì¦ˆ (px)</label>
          <input id="size" type="number" min="64" max="2000" value="400"/>
        </div>
        <div style="width:160px">
          <label>ë§ˆì§„ (px)</label>
          <input id="margin" type="number" min="0" max="50" value="10"/>
        </div>
      </div>

      <div class="row">
        <div style="flex:1">
          <label>ë„íŠ¸ ìŠ¤íƒ€ì¼</label>
          <select id="dotStyle">
            <option value="square">ì •ì‚¬ê°í˜• (Square)</option>
            <option value="dots">ë‘¥ê·¼ ì  (Dots)</option>
            <option value="rounded">ë¼ìš´ë“œ (Rounded)</option>
          </select>
        </div>
        <div style="width:160px">
          <label>ëˆˆ(eye) ìŠ¤íƒ€ì¼</label>
          <select id="eyeStyle">
            <option value="square">ì •ì‚¬ê°í˜•(Eye Square)</option>
            <option value="circle">ì›í˜•(Eye Circle)</option>
            <option value="rounded">ë‘¥ê·¼ í…Œë‘ë¦¬(Rounded)</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div style="flex:1">
          <label>ì „ê²½ ìƒ‰ìƒ</label>
          <input id="dotColor" type="color" value="#061a40"/>
        </div>
        <div style="flex:1">
          <label>ë°°ê²½ ìƒ‰ìƒ</label>
          <input id="bgColor" type="color" value="#ffffff"/>
        </div>
      </div>

      <div>
        <label>ë°°ê²½ íˆ¬ëª… (PNGë¡œ ì €ì¥ ì‹œ íˆ¬ëª… ìœ ì§€)</label>
        <select id="backgroundTransparent">
          <option value="false">ì•„ë‹ˆì˜¤ (ìƒ‰ìƒ ì‚¬ìš©)</option>
          <option value="true">ì˜ˆ (íˆ¬ëª…)</option>
        </select>
      </div>

      <div>
        <label>ë¡œê³  ì´ë¯¸ì§€ (ì„ íƒ)</label>
        <div class="row">
          <input id="logo" type="file" accept="image/*"/>
          <button id="clearLogo" class="btn secondary" type="button">ì‚­ì œ</button>
        </div>
        <div class="row" style="margin-top:8px; gap:12px; align-items:center;">
          <img id="logoPreview" class="logo-preview" src="" alt="" style="display:none"/>
          <div class="small">ë¡œê³ ëŠ” ì¤‘ì•™ì— ì‚½ì…ë¨ (ê¶Œì¥ 64Ã—64)</div>
        </div>
      </div>

      <div class="row">
        <button id="generate" class="btn">ìƒì„±</button>
        <button id="downloadPNG" class="btn" style="background:#34d399">PNGë¡œ ì €ì¥</button>
        <button id="downloadSVG" class="btn" style="background:#fbbf24">SVGë¡œ ì €ì¥</button>
        <button id="copyData" class="btn secondary">ë°ì´í„° ë³µì‚¬</button>
      </div>

      <div>
        <label class="small">ë¯¸ë¦¬ë³´ê¸° ì˜µì…˜</label>
        <div class="small">â€» ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ SVG ë‹¤ìš´ë¡œë“œê°€ ìë™ìœ¼ë¡œ ë‹¤ë¥¸ ì°½ì—ì„œ ì—´ë¦´ ìˆ˜ ìˆìŒ.</div>
      </div>
    </div>

    <div class="panel preview">
      <div class="small flex-between" style="width:100%; align-items:center;">
        <div>ë¯¸ë¦¬ë³´ê¸°</div>
        <div class="small">ì‹¤ì‹œê°„ ë°˜ì˜ë¨</div>
      </div>
      <div id="qr-wrap">
        <!-- QR will be injected here -->
      </div>
      <div class="small" style="opacity:0.85">ì›ë³¸ í¬ê¸°: <span id="infoSize">400</span>px Â· ë§ˆì§„: <span id="infoMargin">10</span>px</div>
    </div>
  </div>

  <footer class="small">ì‚¬ìš©ë²•: í…ìŠ¤íŠ¸/URL ì…ë ¥ â†’ ì˜µì…˜ ì„ íƒ â†’ ìƒì„± â†’ PNG/SVGë¡œ ì €ì¥. ë¡œê³ ëŠ” ì¤‘ì•™ì— ì‚½ì…ë¨.</footer>
</div>

<!-- QR ì½”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬: qr-code-styling (CDN) -->
<script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>

<script>
/*
  êµ¬í˜„ ë…¸íŠ¸:
  - ë¼ì´ë¸ŒëŸ¬ë¦¬: qr-code-styling (https://github.com/kozakdenys/qr-code-styling)
  - ë¡œê³ ë¥¼ ì‚¬ìš©í•˜ë©´ PNG ì €ì¥ ì‹œ ìë™ìœ¼ë¡œ ë¡œê³ ê°€ í¬í•¨ë¨.
  - ë°°ê²½ íˆ¬ëª… ì˜µì…˜ì„ trueë¡œ í•˜ë©´ ë°°ê²½ìƒ‰ ëŒ€ì‹  íˆ¬ëª…ìœ¼ë¡œ ì²˜ë¦¬ (PNGì—ì„œë§Œ ì˜ë¯¸ ìˆìŒ).
*/

const qrWrap = document.getElementById('qr-wrap');
const textInput = document.getElementById('text');
const sizeInput = document.getElementById('size');
const marginInput = document.getElementById('margin');
const dotStyleInput = document.getElementById('dotStyle');
const eyeStyleInput = document.getElementById('eyeStyle');
const dotColorInput = document.getElementById('dotColor');
const bgColorInput = document.getElementById('bgColor');
const generateBtn = document.getElementById('generate');
const downloadPNG = document.getElementById('downloadPNG');
const downloadSVG = document.getElementById('downloadSVG');
const copyDataBtn = document.getElementById('copyData');
const logoInput = document.getElementById('logo');
const logoPreview = document.getElementById('logoPreview');
const clearLogo = document.getElementById('clearLogo');
const bgTransparent = document.getElementById('backgroundTransparent');
const infoSize = document.getElementById('infoSize');
const infoMargin = document.getElementById('infoMargin');

let logoDataUrl = null;

// ê¸°ë³¸ QR ê°ì²´ ìƒì„±
let qr = new QRCodeStyling({
  width: parseInt(sizeInput.value),
  height: parseInt(sizeInput.value),
  margin: parseInt(marginInput.value),
  data: textInput.value,
  image: null,
  dotsOptions: {
    color: dotColorInput.value,
    type: "square"
  },
  cornersSquareOptions: {
    color: dotColorInput.value,
    type: "square"
  },
  cornersDotOptions: {
    color: dotColorInput.value,
    type: "square"
  },
  backgroundOptions: {
    color: bgColorInput.value,
  }
});

// ì´ˆê¸° ë Œë”
qr.append(document.getElementById('qr-wrap'));

// helper
function updateInfo(){
  infoSize.textContent = sizeInput.value;
  infoMargin.textContent = marginInput.value;
}

function applyOptions(){
  const data = textInput.value || "";
  const size = parseInt(sizeInput.value) || 400;
  const margin = parseInt(marginInput.value) || 10;
  const dotStyle = dotStyleInput.value;
  const eyeStyle = eyeStyleInput.value;
  const dotColor = dotColorInput.value;
  const bgColor = bgColorInput.value;
  const transparent = bgTransparent.value === "true";

  // dotsOptions type mapping: library types include "rounded", "dots", "classy", "classy-rounded", "square"
  let dotsType = "square";
  if(dotStyle === "dots") dotsType = "dots";
  else if(dotStyle === "rounded") dotsType = "rounded";
  else dotsType = "square";

  // eye styles mapping: use cornersSquareOptions and cornersDotOptions types
  let cornersSquareType = "square";
  let cornersDotType = "square";
  if(eyeStyle === "circle"){
    cornersSquareType = "square";
    cornersDotType = "dot"; // some libs support 'dot' type; if not, will fallback visually
  } else if(eyeStyle === "rounded"){
    cornersSquareType = "rounded";
    cornersDotType = "rounded";
  } else {
    cornersSquareType = "square";
    cornersDotType = "square";
  }

  // update config
  qr.update({
    width: size,
    height: size,
    margin: margin,
    data: data,
    dotsOptions: {
      color: dotColor,
      type: dotsType
    },
    cornersSquareOptions: {
      color: dotColor,
      type: cornersSquareType
    },
    cornersDotOptions: {
      color: dotColor,
      type: cornersDotType
    },
    backgroundOptions: {
      color: transparent ? "transparent" : bgColor
    },
    image: logoDataUrl // null or dataURL
  });

  updateInfo();
}

// ì‹¤ì‹œê°„ ë°˜ì˜(ê°„ë‹¨)
[textInput, sizeInput, marginInput, dotStyleInput, eyeStyleInput, dotColorInput, bgColorInput, bgTransparent].forEach(el=>{
  el.addEventListener('input', ()=> {
    applyOptions();
  });
});

// ìƒì„± ë²„íŠ¼ (ê°•ì œì  ì¬ìƒì„±)
generateBtn.addEventListener('click', ()=> applyOptions());

// ë¡œê³  ì—…ë¡œë“œ
logoInput.addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    logoDataUrl = ev.target.result;
    logoPreview.src = logoDataUrl;
    logoPreview.style.display = 'block';
    applyOptions();
  }
  reader.readAsDataURL(f);
});

// ë¡œê³  ì‚­ì œ
clearLogo.addEventListener('click', ()=>{
  logoDataUrl = null;
  logoInput.value = "";
  logoPreview.src = "";
  logoPreview.style.display = 'none';
  applyOptions();
});

// ë‹¤ìš´ë¡œë“œ PNG
downloadPNG.addEventListener('click', async ()=>{
  // library provides getDataUrl and download
  try{
    await qr.update({image: logoDataUrl});
    qr.download({extension:"png"});
  }catch(e){
    // fallback: create a dataURL and open
    const url = await qr.getRawData("png");
    const a = document.createElement('a');
    a.href = url;
    a.download = 'qr.png';
    a.click();
  }
});

// ë‹¤ìš´ë¡œë“œ SVG
downloadSVG.addEventListener('click', async ()=>{
  try{
    await qr.update({image: logoDataUrl});
    qr.download({extension:"svg"});
  }catch(e){
    const svg = await qr.getRawData("svg");
    const blob = new Blob([svg], {type:"image/svg+xml"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'qr.svg';
    a.click();
    URL.revokeObjectURL(url);
  }
});

// ë³µì‚¬ (í…ìŠ¤íŠ¸ ë°ì´í„° ë³µì‚¬)
copyDataBtn.addEventListener('click', async ()=>{
  const txt = textInput.value || "";
  try{
    await navigator.clipboard.writeText(txt);
    copyDataBtn.textContent = "ë³µì‚¬ë¨!";
    setTimeout(()=> copyDataBtn.textContent = "ë°ì´í„° ë³µì‚¬", 1200);
  }catch(e){
    alert("í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨ â€” ìˆ˜ë™ ë³µì‚¬ í•„ìš”");
  }
});

// ì´ˆê¸° ë Œë” ì •ë³´
updateInfo();
applyOptions();

</script>
</body>
</html>
